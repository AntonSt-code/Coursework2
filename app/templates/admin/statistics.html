{% extends "base.html" %}
{% block title %}Статистика{% endblock %}
{% block content %}
<h1 class="mb-4">Статистика системи</h1>

<div class="row mb-4">
  <div class="col-md-3">
    <div class="card text-center bg-primary text-white">
      <div class="card-body">
        <h2>{{ stats.total_users }}</h2>
        <p class="mb-0">Користувачів</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center bg-success text-white">
      <div class="card-body">
        <h2>{{ stats.total_books }}</h2>
        <p class="mb-0">Книг</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center bg-info text-white">
      <div class="card-body">
        <h2>{{ stats.total_reviews }}</h2>
        <p class="mb-0">Відгуків</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center bg-warning text-white">
      <div class="card-body">
        <h2>{{ stats.total_downloads }}</h2>
        <p class="mb-0">Завантажень</p>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <h3>Топ-10 книг за завантаженнями</h3>
    <table class="table table-sm table-hover">
      <thead>
        <tr><th>Книга</th><th>Завантажень</th></tr>
      </thead>
      <tbody>
        {% for book, count in top_downloads %}
        <tr>
          <td><a href="{{ url_for('books.detail', book_id=book.id) }}">{{ book.title }}</a></td>
          <td><span class="badge bg-primary">{{ count }}</span></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
  <div class="col-md-6">
    <h3>Топ-10 книг за рейтингом</h3>
    <table class="table table-sm table-hover">
      <thead>
        <tr><th>Книга</th><th>Рейтинг</th><th>Відгуків</th></tr>
      </thead>
      <tbody>
        {% for book in top_rated %}
        <tr>
          <td><a href="{{ url_for('books.detail', book_id=book.id) }}">{{ book.title }}</a></td>
          <td><span class="text-warning">{{ "%.1f"|format(book.average_rating) }} ★</span></td>
          <td>{{ book.reviews_count }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-12">
    <h3>Активність по датах (останні 30 днів)</h3>
    <canvas id="activityChart" height="100"></canvas>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// TODO: Додати графік активності
</script>
{% endblock %}
