{% extends "base.html" %}
{% block title %}Управління користувачами{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Користувачі</h1>
  <div class="badge bg-primary fs-5">Всього: {{ pagination.total if pagination else users|length }}</div>
</div>

<div class="card shadow">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover table-striped mb-0">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Логін</th>
            <th>Email</th>
            <th>Ім'я</th>
            <th>Роль</th>
            <th>Реєстрація</th>
            <th>Статус</th>
            <th class="text-center">Дії</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.id }}</td>
            <td><strong>{{ u.username }}</strong></td>
            <td>{{ u.email }}</td>
            <td>{{ u.first_name or '—' }} {{ u.last_name or '' }}</td>
            <td>
              <span class="badge bg-{{ 'danger' if u.role == 'admin' else 'primary' }}">
                {{ u.role|upper }}
              </span>
            </td>
            <td>{{ u.created_at.strftime('%d.%m.%Y') if u.created_at else '—' }}</td>
            <td>
              {% if u.is_active %}
                <span class="badge bg-success">Активний</span>
              {% else %}
                <span class="badge bg-secondary">Деактивований</span>
              {% endif %}
            </td>
            <td class="text-center">
              <form method="post" action="{{ url_for('admin.toggle_user', user_id=u.id) }}" class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-sm {{ 'btn-warning' if u.is_active else 'btn-success' }}" 
                        {% if u.id == current_user.id %}disabled title="Не можна деактивувати себе"{% endif %}>
                  {{ 'Деактивувати' if u.is_active else 'Активувати' }}
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% if pagination %}
<nav class="mt-4" aria-label="Pagination">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin.users', page=pagination.prev_num) if pagination.has_prev else '#' }}">«</a>
    </li>
    {% for p in range(1, pagination.pages + 1) %}
    <li class="page-item {% if p == pagination.page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('admin.users', page=p) }}">{{ p }}</a>
    </li>
    {% endfor %}
    <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin.users', page=pagination.next_num) if pagination.has_next else '#' }}">»</a>
    </li>
  </ul>
</nav>
{% endif %}
{% endblock %}
